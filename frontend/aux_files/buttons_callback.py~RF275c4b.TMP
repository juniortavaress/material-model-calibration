from frontend.aux_files.get_conditions import GetCondition
from frontend.aux_files.get_parameters import GetParameters
from frontend.aux_files.get_pso_and_simulation_info import GetPsoAndSimulation
from backend.config.config_software import SoftwareConfig
from backend.pso.start_otimization import OtimizationManager
from backend.get_result_from_odb_file.create_graphs import createPlots
from backend.aux_files.aux_geometry.layout.graphLayout import GraphLayout
from backend.aux_files.aux_geometry.datas.setAndSaveDefautDatas import DataInicialization
from backend.aux_files.aux_geometry.geometry.getGeometry import GetGeometry
# from backend.aux_files.aux_geometry.geometry_graph import GetGeometry
from frontend.aux_files.test2 import GeometryGraphs
from PySide6.QtWidgets import QApplication, QMainWindow, QLineEdit, QFileDialog
from PySide6.QtGui import QIcon

class ButtonsCallback():
    """Handles the callback functions for buttons in the user interface."""
        
    def activate_buttons(self):
        """Activate the buttons and configure initial interface conditions."""
        SoftwareConfig.software_setup(self)
        
        # Initial Interface Conditions
        self.ui.frame_105.hide()
        self.ui.frame_temperature.hide()
        self.ui.label_login_warning.hide()
        self.ui.label_path_warning.hide()
        self.ui.label_condition_warning.hide()
        self.ui.label_limits_warning.hide()
        self.ui.label_pso_result_warning.hide()
        self.ui.button_settings_next_page.setEnabled(False)
        self.resize(1000, 400) if not self.isMaximized() else None

        self.ui.frame_20.hide()
        self.ui.pages.setCurrentIndex(4)

        # Page 01 - Project Name
        self.ui.button_login_next_page.clicked.connect(lambda: SoftwareConfig.project_setup(self))
        self.ui.button_login_next_page.clicked.connect(lambda: SoftwareConfig.verify_gui_stage(self))

        # Page 02 - Abaqus and Results Path
        self.ui.button_abaqus.clicked.connect(lambda: SoftwareConfig.set_software_config_path(self))
        self.ui.button_result.clicked.connect(lambda: SoftwareConfig.get_results_folders(self))
        self.ui.button_settings_next_page.clicked.connect(lambda: self.ui.pages.setCurrentIndex(2))
        self.ui.button_result.clicked.connect(lambda: SoftwareConfig.set_user_config_path(self))
        self.ui.button_settings_next_page.clicked.connect(lambda: GetCondition.set_conditions(self)) # Para quando tem valores salvos
            
        # Page 03 - Explanation for creating the conditions
        self.ui.button_conditions_limitation_next_page.clicked.connect(lambda: self.ui.pages.setCurrentIndex(3))
        self.ui.button_conditions_limitation_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(1))

        # Page 0X - Create setup or import setup
        self.ui.button_import_inp.clicked.connect(lambda: self.ui.pages.setCurrentIndex(5))
        self.ui.button_import_inp.clicked.connect(lambda: self.ui.frame_15.show())
        self.ui.button_import_inp.clicked.connect(lambda: self.ui.frame_20.show())
        self.ui.button_create_geometry.clicked.connect(lambda: self.ui.pages.setCurrentIndex(4))
        self.ui.button_create_geometry.clicked.connect(lambda: self.ui.frame_15.hide())
        self.ui.button_create_geometry.clicked.connect(lambda: self.ui.frame_20.hide())

        # Page 0X
        # self.ax_geometry, self.fig_geometry, self.canvas_geometry = GraphLayout.create_plot_areas(self, self.ui.plot, '3d')
        # self.resizeEvent = lambda event: GraphLayout.resize(self)

        GeometryGraphs.canvas(self)
        self.ui.tabWidget.currentChanged.connect(lambda: GetGeometry.set_info(self))
        self.ui.button_create_geometry_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(3))
        self.ui.button_create_geometry_next.clicked.connect(lambda: self.ui.pages.setCurrentIndex(5))
        self.ui.defautValues.stateChanged.connect(lambda: DataInicialization.get_defaut_datas(self))
        self.ui.applyButton.clicked.connect(lambda: GetGeometry.set_info(self))
        # self.ui.button_create_geometry_next.clicked.connect(lambda: GetGeometry.save_infos(self))
        # self.ui.applyButton.clicked.connect(lambda: GetGeometry.set_info(self))


        # for widget in self.ui.geometryPage.findChildren(QLineEdit):
        #     widget.textChanged.connect(lambda: GetGeometry.set_info(self))


        # Page 04 - Create Conditions
        self.ui.button_conditions_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(3))
        self.ui.comboBox_condition.currentIndexChanged.connect(lambda: GetCondition.change_combobox_info(self))
        self.ui.button_input_file.clicked.connect(lambda: GetCondition.get_input_path(self))
        self.ui.button_newCondition.clicked.connect(lambda: GetCondition.get_defaut_user_conditions(self, "new"))


        self.ui.button_conditions_next_page.clicked.connect(lambda: GetParameters.save_parameters(self, "load"))
        self.ui.button_conditions_next_page.clicked.connect(lambda: GetCondition.save_conditions(self))
        self.ui.button_conditions_next_page.clicked.connect(lambda: GetParameters.parameter_and_interface_manager(self))


        # Page 05 - Selection of Parameters to Calibrate
        self.ui.button_parameter_selection_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(5))
        self.ui.button_parameter_selection_next_page.clicked.connect(lambda: self.ui.pages.setCurrentIndex(7))
        self.ui.button_parameter_selection_next_page.clicked.connect(lambda: GetParameters.save_parameters(self, "save"))

        # Page 06 - Parameters Boundary Definition
        self.ui.button_parameter_limits_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(6))
        self.ui.button_parameter_limits_next_page.clicked.connect(lambda: GetParameters.save_parameters_limits(self))

        # Page 07 - PSO Explanation
        self.ui.button_pso_explanation_next_page.clicked.connect(lambda: self.ui.pages.setCurrentIndex(9))
        self.ui.button_pso_explanation_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(7))
        self.ui.button_pso_explanation_next_page.clicked.connect(lambda: GetPsoAndSimulation.load_info(self))

        # Page 08 - PSO Parameters Definition
        self.ui.button_pso_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(8))
        self.ui.button_pso_next_page.clicked.connect(lambda: GetPsoAndSimulation.save_info(self))
        self.ui.button_pso_next_page.clicked.connect(lambda: OtimizationManager.main(self))

        # Page 09 - Model Calibration
        self.ui.button_code_tracking_next_page.clicked.connect(lambda: self.ui.pages.setCurrentIndex(11))
        self.ui.button_code_tracking_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(9))

        # Page 10 - Results Visualization
        self.ui.button_result_back.clicked.connect(lambda: self.ui.pages.setCurrentIndex(10))
        self.ui.combobox_file.currentIndexChanged.connect(lambda: createPlots.graphs_manager(self))
        self.ui.combobox_analysis_type.currentIndexChanged.connect(lambda: createPlots.graphs_manager(self))
